
#UNPACK THE FASTQ FILES
tar xzf methylation_fastq.tar.gz

#QUALITY CONTROL CHECK ON THE FASTQ FILES USING FASTQC
$fastqc *.fastq -o

#make a folder called index and put the chr6 refernce genome inside it
$mkdir index
$cp chr6.fa.gz /Users/cmdb/qbb2021-answers/week4/index

## create an index for mapping chr6 using the whole index folder
bismark_genome_preparation index --parallel 7

#INDEX THE REFERENCE GENOME FOR THE TWO SRR FILES
$Bismark --fastq index -1 SRR3083926_1.chr6.fastq -2 SRR3083926_2.chr6.fastq Bisulfite_Genome

$Bismark --fastq index -1 SRR3083929_1.chr6.fastq -2 SRR3083929_2.chr6.fastq Bisulfite_Genome

#DUPLICATE THE RESULTING BAM FILES
$deduplicate_bismark *.bam

#SORT THE DUPLICATED FILE 
$samtools sort SRR3083926_1.chr6_bismark_bt2_pe.deduplicated.bam -o SRR3083926.ch6_sorted.bam
$samtools sort SRR3083929_1.chr6_bismark_bt2_pe.deduplicated.bam -o SRR3083929.ch6_sorted.bam

#INDEX THE RESULTING SORTED FILES FROM ABOVE
$samtools index SRR3083926.ch6_sorted.bam
$samtools index SRR3083929.ch6_sorted.bam

#EXTRACT METHYLATION DATA FROM THE DUPLICATED FILES AND VEIW ON IGV
$bismark_methylation_extractor --bedgraph --comprehensive SRR3083926_1.chr6_bismark_bt2_pe.deduplicated.bam
$bismark_methylation_extractor --bedgraph --comprehensive SRR3083929_1.chr6_bismark_bt2_pe.deduplicated.bam

$igv

#EXTRACT PROMOTERS FROM THE REFSEQ GENES FILE AND WRITE THEM INTO THE PROMOTERS.BED FILE
awk 'BEGIN{OFS="\t"}{if ($4 == "+") print $3,$5 - 2000,$5,$13,$12,$4; else print $3,$6,$6 + 2000,$13,$12,$4;}' mm10_refseq_genes_chr6_50M_60M.bed | grep -v Rik | uniq -f 3 | sort -k2,2n > promoters.bed

###SEE THE REST OF THE ANSWERS IN THE JUPYTER NOTEBOOK###

